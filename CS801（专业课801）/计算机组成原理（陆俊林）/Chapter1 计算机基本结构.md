# 第一章 计算机基本结构（Basic Components of a Computer）

[TOC]



## 第一节 电子计算机的兴起

### “现代电子计算机之父” —— 冯·诺依曼

<img src="1-1.jpg" />

> 冯·诺依曼在二战期间参与原子弹的研制工作，遇到一个很大的困难，是运算量太庞大。于是他就致力于寻找具有强大运算能力的设备。



###### “二战”对计算能力的需求

<img src="1-2.jpg" />



### 电子计算机时代的到来

#### ENIAC（宾夕法尼亚大学）—— 世界上第一台通用电子计算机

<img src="1-3.jpg" />

<img src="1-4.jpg" />

> 它实际上是在二战结束后才完成的， 并没有为二战的火炮图做出什么贡献。
>
> 但它在之后的弹道计算、原子弹研究、气象预报等很多方面发挥了重要作用。

> 它是**世界上第一台通用电子计算机**，因为在它之前已经有人设计出了**电子计算机**。



#### ABC（美国艾奥瓦州立大学） —— 阿塔纳索夫-贝里计算机

<img src="1-5.jpg" />

> ENIAC的设计借鉴了ABC。
>
> 很多年后，因为ENIAC的设计思想来源于ABC，所以ENIAC的专利被判无效。



#### 冯·诺依曼对ENIAC的分析

###### “存储程序”的概念

> ENIAC的开关定位和转插线只不过代表着一些数字信息，完全可以像受程序管理的数据一样，存放于主存储器中。



###### 冯·诺依曼和《关于EDVAC的报告草案》

<img src="1-6.jpg" />



#### EDVAC —— 存储程序式计算机（冯·诺依曼结构计算机）

###### 主要特点

> - 实现“存储程序”概念，大幅提升了任务效率
> - 质量和数据采用二进制，极大简化了逻辑线路
> - 由五个基本部分组成
>   - 运算器
>   - 控制器
>   - 存储器
>   - 输入设备
>   - 输出设备

<img src="1-7.jpg" />

> 但EDVAC不是世界上第一台冯·诺依曼结构计算机，因为研究团体解散等问题，它被EDSAC抢了先。



#### EDSAC —— 第一台实用的存储程序式计算机

###### 五个组成部分

> - **运算器**和**控制器**：电子管
> - **存储器**：水银延迟线
> - **输入设备**：从穿孔纸带输入
> - **输出设备**：电传打印机

<img src="1-8.jpg" />



#### UNIVAC —— 开启了商用计算机的时代

<img src="1-9.jpg" />

###### 1952年 —— 统计总统选票

<img src="1-10.jpg" />



#### IBM701

<img src="1-11.jpg" />

> **UNIVAC** 开启了商用计算机的时代。



#### 众多著名计算机

###### IBM S/360 —— 1964年

<img src="1-12.jpg" />



###### CDC6600（第一台超级计算机） —— 1964年

<img src="1-13.jpg" />



###### PDP-8 —— 1965年（小型计算机的经典）

<img src="1-14.jpg" />



###### Altair8800 —— 1975年（第一台微型计算机）

<img src="1-15.jpg" />



###### Apple II —— 1977年（微型计算机经典）

<img src="1-16.jpg" />



###### IBM PC 5150 —— 1981年（微型计算机经典）

<img src="1-17.jpg" />



###### IBM zEC12 —— 2012年（当前最先进的大型计算机之一）

<img src="1-18.jpg" />



###### 天河二号 —— 2013年（当前最快的超级计算机）

<img src="1-19.jpg" />



## 第二节 冯·诺依曼结构的要点

### 《关于EDVAC的报告草案》

> 该报告所描述的计算机结构，即为 **“冯·诺依曼计算机结构”** ， 简称 **“冯·诺依曼结构”**。

###### 两个重要思想

> - 存储程序（而不是开关连线）
> - 二进制（而不是十进制）

###### 明确了计算机的五个部分

> - 运算器
> - 控制器
> - 存储器
> - 输入设备
> - 输出设备

<img src="1-2-1.jpg" />



### Intel 4004 —— 世界上第一个商业微处理器

<img src="1-2-2.jpg" />

<img src="1-2-3.jpg" />

<img src="1-2-4.jpg" />



### 冯·诺依曼结构的要点

#### 计算机的五大组成部分

1. 运算器 CA - Central Arithmetical
2. 控制器 CC - Central Control
3. 存储器 M - Memory
4. 输入设备 I - Input
5. 输出设备 O - Output

<img src="1-2-5.jpg" />

> - 计算机应由**运算器**、**控制器**、**存储器**、**输入设备**和**输出设备**共5个部分组成
> - 数据和程序均以二进制代码形式不加区别地存放在存储器中，存放位置由存储器的地址指定
> - 计算机在工作时能够自动地从存储器中取出指令加以执行
> - ......



#### 冯·诺依曼结构的核心 —— 运算器、控制器、存储器

<img src="1-2-6.jpg" />

###### 现代个人计算机中的CPU和主存

<img src="1-2-7.jpg" />

###### 主存的组织形式

<img src="1-2-8.jpg" />



#### 冯·诺依曼计算机的类比

<img src="1-2-9.jpg" />

> 将**程序**和**数据**不加区分地存储在**存储器**当中。



#### :star:存储程序的概念总结

> - 计算机中所需要的程序和数据通过**输入设备**进入了**存储器**
> - **控制器**发出地址给**存储器**，获得程序当中的对应的指令，还可以得到相应的数据
> - **控制器**发命令给**运算器**，指挥**运算器**对数据进行相应的运算
> - **运算器**返回一些运算的状态，比如是否正确完成等等，最后还会将运算的结构存储到**存储器**中
> - 最后通过**输出设备**将运算结果输出到计算机外部的某些存储介质上

<img src="1-2-10.jpg" />



## 第三节 冯·诺依曼结构的小故事

### 关于计算机运行过程的类比

> 冯·诺依曼结构的计算机就好比这个餐馆：
>
> CPU就是厨房，主存就是仓库。
>
> 仓库中的货架就好比主存当中的存储单元，我们为货架的每一格都编上了一个序号，相当于主存当中的地址，而货架上存放的物品相当于存储单元中的内容。
>
> 主存中会存放着计算机中的指令，还有数据，对于这个餐馆来说就是厨师所要执行的任务，和做菜所用的原料。
>
> 在厨房当中，承担主要控制任务的就是这位大厨了，他就是控制器。
>
> 而运算器则是厨具。
>
> 那我们还需要一些附加的设备。
>
> 这个厨师记性很不好，他必须要在身边有一张纸，上面写着下一张任务单的位置。
>
> 如果把任务单取回来以后，还需要放在身边随时地查看，所以他还得有一个放置当前任务单的位置。
>
> 厨师做菜，做完了菜放哪儿呢，不能直接端着锅冲到仓库去吧。所以他身边的操作台上总得放几个盘子，相当于CPU中的通用寄存器，用于临时存放运算器的运算结果，或者要送到运算器的操作数。

<img src="1-3-1.jpg" />



### 执行指令：计算机运转的核心内容

#### 计算机执行一条指令的主要步骤

- 第一步：取指（Fetch）
- 第二步：译码（Decode）
- 第三步：执行（Execute）
- 第四步：回写（Write-back）



#### 第一步：取指（取任务单）

> 厨师第一步要做的事情就是查看下一张任务单的位置在哪儿，我要去取这张任务单了，一查，发现是1。
>
> 向主存发出请求，我需要第1格的物品。（他并不知道第1格存放的是什么，他只是根据这里的编号，向主存发出申请）
>
> 主存并不简单是一些货架，它还是要有一些控制逻辑。那么这里控制逻辑就会响应控制器的请求，找到第1格的物品并送回。
>
> 厨师收到任务单了，就把它放在身边存放当前任务单的位置。
>
> 这就完成了第一步，取任务单。
>
> 取回后更新下张任务单的位置。

<img src="1-3-2.jpg" />

<img src="1-3-3.jpg" />



#### 第二步：译码（分析任务）

> 对厨师来说，就是分析刚才拿到的任务单。
>
> 任务单上说明了这项任务所需要的方法、所需要的原料、成果存放在某个地方。
>
> 控制器就把它转换成若干组的控制信号。

<img src="1-3-4.jpg" />



#### 第三步：执行

> 向主存发出请求，说我需要第6格的物品。
>
> 主存会响应，把第6格的物品送过来。
>
> 由于这一次是取运算所需要的操作数，所以返回的物品呢，控制器就会把它放到运算器的其中一个入口。
>
> 然后第二步是取这个运算的第二个操作数。
>
> 第三步是执行这项运算，控制器会给出对应的运算信号给运算器让它执行对应的运算。
>
> 运算完成了，运算结果也产生了，执行阶段就到此结束了。

<img src="1-3-5.jpg" />



#### 第四步：回写（保存结果）

> 运算结果还放在运算器的输出端口上，我们必须要把它转移。
>
> 根据这条指令的要求，运算的结果应该是存放到A号的通用寄存器里。
>
> 我们在最后一步回写，也就是保存结果的时候呢，用控制器把这个结果传送到A号的通用寄存器当中。
>
> 这样就完成了执行指令的全部过程。

<img src="1-3-6.jpg" />



### 计算机执行指令的过程

<img src="1-3-7.jpg" />



## 第四节 计算机结构的简化模型

<img src="1-4-1.jpg" />

> 对照冯·诺依曼结构的餐馆，构造出计算机结构的简化模型（模型机）。

<img src="1-4-2.jpg" />



### 模型机的存储器

#### 编址方式

> 在设计计算机时要确定存储器的**编址方式**，如果存储器按字节编址，那每一个存储单元就能够存放8位的二进制数。

##### 地址总线

> 而且每个存储单元的地址是唯一的。CPU要想访问某个存储单元，必须通过地址总线给出相应的地址。

> 如果地址总线宽度为 n，则CPU能管理的存储单元最多为 $2^n$ 个。

##### MAR

> MAR（Memory Address Register, 存储器地址寄存器）
>
> CPU发来的地址，将会存放在**存储器地址寄存器**中。

##### 数据总线

> CPU所要读写的数据则会通过数据总线传送。
>
> 数据总线宽度一般为存储单元位宽的整数倍。

##### MDR

> MDR（Memory Data Register，存储器数据寄存器）
>
> 对应的数据则放在被称为存储器数据寄存器的结构中。

##### 控制总线

> 控制总线与存储器当中的控制逻辑相连，用于接收来自CPU的读写信号，或者向CPU反馈传输已经完成的信号。

<img src="1-4-3.jpg" />



### 模型机的CPU - 控制器

#### 功能

> 控制器用于控制计算机各部件完成取指令、分析指令和执行指令等功能。

#### 主要组成部分

> - 指令寄存器 IR（Instruction Register）
> - 程序计数器 PC（Program Counter）
> - 存储器地址寄存器 MAR（Memory Address Register）
> - 存储器数据寄存器 MDR（Memory Data Register）
> - 指令译码部件
> - 控制电路

<img src="1-4-4.jpg" />

##### 指令寄存器 IR

> 用于存放正在执行或者即将执行的指令。
>
> 这个指令是从存储器中取来的，暂时存放在这个寄存器里。

##### 程序计数器 PC

> 用于存放下一条指令的存储单元地址。
>
> 具有自动增量计数的功能。

##### 存储器地址寄存器 MAR

> 用于存放存储单元的地址。

##### 存储器数据寄存器 MDR

> 用于存放对存储单元读/写的数据。

<img src="1-4-5.jpg" />

##### 指令译码

> 对IR中的指令进行译码，以确定IR中存放的是哪一条指令。

##### 控制电路

> 当确定了是哪一条指令之后，控制电路就可以产生控制信号，在时序脉冲的同步下控制各个部件的动作。

<img src="1-4-6.jpg" />



### 模型机的CPU - 运算器

#### 功能

> 运算器用于算术运算和逻辑运算
>
> - 常见算术运算
>   - 加、减、乘、除等
> - 常见逻辑运算
>   - 非、与、或等

##### ALU（算术逻辑单元）

> 核心部件ALU用于完成算术运算和逻辑运算。
>
> ALU对X、Y中的数据进行运算，将结果送到Z。
>
> X、Y、Z作为ALU的数据暂存器，可视为ALU的一部分。
>
> 寄存器F 用于存放运算结果的状态（零/正负/进位/溢出）

##### 通用寄存器

> n个通用寄存器，用于临时存放数据。
>
> 数据可能来自存储器，也可能来自其他通用寄存器或ALU的输出。

<img src="1-4-7.jpg" />



### CPU的内部总线

> 内部总线用于在CPU内部各个部件之间传递数据。

#### 举例

> 将数据从R0 传送到 X（可能是为下一次运算进行准备）

> 从R0 传送到X，我们可以理解为在控制电路的控制下，将R0的出水管打开，再将X的入水管打开，与此同时，将其他部件的出水管和入水管都关闭。
>
> 这样R0 所保存的数据就像水流一样经过了内部总线，流到了X当中。
>
> 那么经过一段时间之后，X中保留的数，就跟R0中保存的数一样了。

<img src="1-4-8.jpg" />



## 第五节 计算机执行指令的过程

